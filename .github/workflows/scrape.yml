name: Daily Commodity Scraper

on:
  schedule:
    # Runs Mondayâ€“Friday at 5:15 PM BDT = 11:15 AM UTC
    - cron: '45 11 * * 1-5'
  workflow_dispatch:  # Allow manual trigger
  push:               # Run on push to main branch
    branches:
      - main

jobs:
  scrape:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '20'

    - name: Install dependencies
      run: npm ci

    - name: Install required Chromium dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          fonts-liberation libnss3 libxss1 xdg-utils \
          libatk-bridge2.0-0 libgtk-3-0 libasound2

    - name: Write creds.json from secret
      run: echo "$GOOGLE_CREDS_JSON" > creds.json
      env:
        GOOGLE_CREDS_JSON: ${{ secrets.GOOGLE_CREDS_JSON }}

    - name: Run Puppeteer script
      run: node cot_testing.js
